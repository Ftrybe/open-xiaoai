# 小爱音箱自定义消息管理系统 🎵

## 功能概述

这是一个强大的可视化管理系统，用于管理小爱音箱的自定义消息处理规则。支持多种触发方式和丰富的响应类型。

## 🌐 访问地址

- **Web管理界面**: http://localhost:3000/index.html
- **API接口**: http://localhost:3000/api/*

## ✨ 主要功能

### 1. 触发条件配置

支持四种匹配方式：

- **精确匹配**: 完全匹配指定文本
- **以...开始**: 消息以指定文本开头
- **包含**: 消息包含指定文本
- **以...结束**: 消息以指定文本结尾

### 2. 响应类型

#### 📝 文字回复
直接回复指定的文字内容

#### 🎵 音频播放
- 支持播放网络音频链接
- 可设置播放前的提示文字

#### ⚡ 本地代码执行
- 直接在服务内执行JavaScript代码
- 拥有完整的系统权限（包括`engine`对象访问）
- ⚠️ 安全提示：请谨慎使用，避免执行不受信任的代码

#### 🔒 沙盒代码执行
- 在受限环境中执行JavaScript代码
- 更安全，但功能受限（无法访问`engine`对象）
- 适合进行数据处理、计算等操作

#### 🌐 API接口调用
- 支持GET、POST、PUT、DELETE方法
- 可自定义请求头和请求体
- 自动解析JSON响应

#### 🐍 Python远程执行
- 在远程服务器执行Python代码
- 支持设置超时时间
- 需要配置远程执行服务

#### 🟢 Node.js远程执行
- 在远程服务器执行Node.js代码
- 支持异步操作
- 需要配置远程执行服务

## 🚀 使用步骤

1. **启动服务**
   ```bash
   cd /path/to/project
   pnpm dev
   ```

2. **访问管理界面**
   打开浏览器访问: http://localhost:3000/index.html

3. **添加自定义规则**
   - 切换到"添加新规则"标签
   - 配置触发条件（匹配方式和关键词）
   - 选择响应类型并填写相应配置
   - 点击"添加规则"

4. **管理现有规则**
   - 在"消息规则管理"标签查看所有规则
   - 可以删除不需要的规则
   - 规则修改后立即生效，无需重启服务

## 🛠️ 高级功能

### 远程代码执行服务

如果需要使用Python或Node.js远程执行功能，需要启动远程执行服务：

```bash
# 启动远程执行服务（端口3001）
pnpm remote-executor

# 或者同时启动主服务和远程执行服务
pnpm dev-with-executor
```

远程执行服务提供以下端点：
- **执行代码**: POST http://localhost:3001/execute
- **健康检查**: GET http://localhost:3001/health

### API接口

系统提供RESTful API：

- `GET /api/rules` - 获取所有规则
- `POST /api/rules` - 添加新规则
- `DELETE /api/rules/:id` - 删除规则
- `GET /api/settings` - 获取全局设置
- `POST /api/settings` - 更新全局设置

## 📋 使用示例

### 示例1: 简单文字回复
- **触发条件**: 精确匹配 "你好"
- **响应类型**: 文字回复 "你好！很高兴见到你！"

### 示例2: 智能家居控制
- **触发条件**: 以"开"开始
- **响应类型**: 本地代码执行
```javascript
const command = text.substring(1); // 去掉"开"字
await engine.speaker.abortXiaoAI();
return { text: `正在为您${text}` };
```

### 示例3: 天气查询API
- **触发条件**: 包含 "天气"
- **响应类型**: API接口调用
- **API地址**: https://api.weather.com/current
- **方法**: GET

### 示例4: Python数据分析
- **触发条件**: 精确匹配 "分析数据"
- **响应类型**: Python远程执行
```python
import pandas as pd
import numpy as np

data = np.random.randn(100)
mean_val = np.mean(data)
print(f"数据均值: {mean_val:.2f}")
```

## 🔧 配置文件

系统自动生成以下配置文件：
- `custom-rules.json` - 存储自定义规则
- `custom-settings.json` - 存储全局设置

这些文件支持热重载，修改后立即生效。

## ⚠️ 安全提示

1. **本地代码执行**具有完整的系统权限，请仅执行可信代码
2. **远程代码执行**服务应部署在受信任的环境中
3. **API调用**可能会暴露敏感信息，请谨慎配置
4. 建议定期备份配置文件

## 🐛 故障排除

### 服务无法启动
- 检查端口3000是否被占用
- 确认所有依赖已正确安装

### 规则不生效
- 检查规则是否已启用
- 确认触发条件匹配方式正确
- 查看服务器日志输出

### 远程执行失败
- 确认远程执行服务已启动
- 检查网络连接和URL配置
- 验证代码语法正确性

## 📞 支持

如有问题或建议，请查看项目文档或联系开发团队。

---

享受智能语音助手的强大功能！🎉
